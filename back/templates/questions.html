<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hello Bulma!</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="static/style.css">
    <script
      src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"
    ></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  </head>
  <nav class="navbar is-primary" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <strong>Recipe Wizard</strong>
      </a>

      <!-- <a
        role="button"
        class="navbar-burger burger"
        aria-label="menu"
        aria-expanded="false"
        data-target="navbarBasicExample"
      > -->
        <span aria-hidden="true"></span> <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>
  </nav>
  <body>
    <section class="section">
      <div class="container">

        <h1 class="title" name="question"></h1>
        <div class="buttons title-buttons">
            <button id="yes-button" class="button is-medium is-outlined is-success">
            Yes
            </button>
            <button id="no-button" class="button is-medium is-outlined is-danger">
                No
            </button>
        </div>

          <progress class="progress is-primary" value="15" max="100">15%</progress>


          <hr>

        <h1 class="custom-title">Recipes</h1>


        <!-- <div class="columns is-mobile food-border">
            <div class="column is-9">
                <p class="food-title">Tika Panjabu</p>
            </div>
            <div class="column">
                ðŸŒ¿ ðŸ”¥
            </div>
        </div>

      <div class="columns is-mobile food-border">
          <div class="column is-9">
              <p class="food-title">Frozen Blueberry Yogurt</p>
          </div>
          <div class="column">
              ðŸ¥›
          </div>
      </div>

      <div class="columns is-mobile">
          <div class="column is-9">
              <p class="food-title">Homemade Snickers Bars</p>
          </div>
          <div class="column">
              ðŸ¥œ
          </div>
      </div> -->

      </div>
      <br/>

    </section>

    <div class = "inventory-button">
        <div class = "close" onclick="$('.notification').toggleClass('active')">
            <div class = "text">
                <i class="fas fa-sort-up"></i>
            </div>
        </div>
    </div>

    <div class = "notification active">

        <div class="columns is-mobile">
            <div class="column is-9">
                <p class="is-5">Your pantry</p>
            </div>
            <div class="column">
                <div class = "close" onclick="$('.notification').toggleClass('active')">
                    <div class = "text">
                        <i class="fas fa-sort-down"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="columns is-mobile tag-column">
            <div class="column">
                <div class="tags">
                    {% with messages = get_flashed_messages() %}
                    {% if messages %}
                    <ul class=flashes>
                        {% for message in messages[0] %}
                        <span class="tag is-primary is-medium">{{ message }} <button class="delete is-small"></button></span>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% endwith %}
                </div>
            </div>
        </div>

    </div>

    <script type="text/javascript">
        var latest;

        function handleNewQuestion(q) {
            console.log("Updated latest");
            latest = q;
        }
        function updateQuestion() {
            $.ajax({
                url : `http://${window.location.host}/question`,
                type : "GET",
                async: false,
                success : function(vec) {
                    handleNewQuestion(vec.question);
                }
            });
        };

      $( document ).ready(() => {
        $.ajax({
        url : `http://${window.location.host}/question`,
        type : "GET",
        async: false,
        success : function(vec) {
            console.log(vec);
            $(".title").text(`Do you have ${vec.question}?`);
            latest = vec.question;
            console.log(latest);
            for(var i = 0; i < vec.recipes.length; i++) {
                var jedlo = `<a href="http://${window.location.host}/recipe">
                                <div class="columns is-mobile food-border">
                                    <div class="column is-9">
                                        <p name="${vec.recipes[i].id}" class="food-title">${vec.recipes[i].name}</p>
                                    </div>
                                    <div class="column">
                                        ðŸ¥œ
                                    </div>
                                </div>
                            </a>`;
            $(".container").append(jedlo);
            }   
        }
        });
      });

      $("#yes-button").click(() => {
        var temp = latest;
        $.ajax({
        url : `http://${window.location.host}/question`,
        data: {
          response: "yes",
        },
        type : "GET",
        async: false,
        success : function() {
            $(".title").text(`Do you have ${latest}?`);
            updateQuestion();
            $(".tags").append(`<span class="tag is-primary is-medium">${temp}<button class="delete is-small"></button></span>`);
        },
        error: function() {
            $(".title").text(`Do you have ${latest}?`);
            updateQuestion();
            $(".tags").append(`<span class="tag is-primary is-medium">${temp}<button class="delete is-small"></button></span>`);
        }
        
      }
      )});

      $("#no-button").click(() => {
        var temp = latest;
        $.ajax({
        url : `http://${window.location.host}/question`,
        data: {
          response: "no",
        },
        type : "GET",
        async: false,
        success : function() {
            $(".title").text(`Do you have ${latest}?`);
            updateQuestion();
        },
        error: function() {
            $(".title").text(`Do you have ${latest}?`);
            updateQuestion();
        }
        
      }
      )});
    //   <span class="tag is-primary is-medium">test<button class="delete is-small"></button></span>

    //   <a href="http://${window.location.host}/recipe/${vec.recipes[i].id}">

    </script>
  </body>
</html>
